name: Pyinstaller Executable

on:
  workflow_dispatch:
  workflow_call:

jobs:
  # start_release:
  #   name: Start Release
  #   runs-on: ubuntu-latest
  #   outputs:
  #     release_id: ${{ steps.create_release.outputs.id }}
  #     upload_url: ${{ steps.create_release.outputs.upload_url }}
  #   steps:
  #   - name: Create release
  #     id: create_release
  #     uses: actions/create-release@v1
  #     env:
  #       GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # This token is provided by Actions, you do not need to create your own token
  #     with:
  #       tag_name: ${{ github.ref }}
  #       release_name: Release ${{ github.ref }}
  #       body: |
  #         Duploctl Release
  #       draft: true
  #       prerelease: false
  installer:
    name: Pyinstaller
    # needs: start_release
    runs-on: ${{ matrix.os }}-latest
    strategy:
      fail-fast: false
      matrix:
        os:
        - windows
        - ubuntu
        - macos
    steps:

    - name: Checkout Code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.12"
        cache: pip
    
    - name: Install Dependencies
      run: pip install .[build]
    
    - name: Pyinstaller
      id: installer
      run: pyinstaller cli.spec

    - name: View Files
      run: |
        ls dist
        ls dist/cli

    - uses: actions/upload-artifact@v4
      with:
        name: duploctl-${{ matrix.os }}
        path: dist/cli/duploctl*
  
    
